<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Contr√¥le A√©rien ‚Äî FX CONTROL BETA</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <header>
    <h1>FX CONTROL</h1>
    <div id="session-time">Temps: 00:00</div>
  </header>

  <aside id="selected-info" class="hidden">
    <div class="info-panel">
      <div class="info-img"><img id="info-img" src="" alt=""></div>
      <div class="info-meta">
        <div id="info-callsign" class="info-line info-title"></div>
        <div id="info-type" class="info-line"></div>
        <div id="info-model" class="info-line"></div>
        <div id="info-origin" class="info-line"></div>
        <div id="info-origin-country" class="info-line"></div>
        <div id="info-destination" class="info-line"></div>
        <div id="info-status" class="info-line"></div>
        <div id="info-alt" class="info-line"></div>
        <div id="info-spd" class="info-line"></div>
        <div id="info-hdg" class="info-line"></div>
        <div id="info-passengers" class="info-line"></div>
        <div id="info-weight" class="info-line"></div>
        <div id="info-airline" class="info-line"></div>
        <div id="info-fuel" class="info-line fuel-info"></div>
        <div id="info-radio" class="info-line"></div>
      </div>
    </div>
  </aside>

  <!-- Server selection overlay (launcher style) -->
  <div id="server-select" style="display:none;">
    <div class="server-panel">
      <div class="server-hero">
        <div class="server-hero-overlay"></div>
        <div class="server-hero-content">
          <div class="server-logo">üõ´</div>
          <div class="server-title-wrap">
            <h2 class="server-title">FX CONTROL</h2>
            <p class="server-subtitle">Contr√¥leur A√©rien ‚Äî S√©lection du serveur</p>
          </div>
        </div>
      </div>
      <div class="server-body">
        <div class="server-warning" role="alert">
          Attention: le mode multijoueur contient encore des bugs importants.
        </div>
        <ul class="server-cards">
          <li class="server-card">
            <div class="card-left">
              <div class="card-badge">OFFICIEL</div>
              <div class="card-name">Serveur Local</div>
              <div class="card-meta">
                <span class="meta-pill"><span class="dot online"></span> En ligne</span>
                <span class="meta-pill">Ping ~1 ms</span>
              </div>
            </div>
            <div class="card-right">
              <button id="server-local-btn" class="server-btn-primary">
                <span class="btn-icon">‚ñ∂</span>
                Jouer
              </button>
            </div>
          </li>
          <li class="server-card">
            <div class="card-left">
              <div class="card-badge">CERTIFI√â</div>
              <div class="card-name">Serveur Multijoueur</div>
              <div class="card-meta">
                <span class="meta-pill"><span class="dot online"></span> En ligne</span>
                <span class="meta-pill">3 joueurs max</span>
              </div>
            </div>
            <div class="card-right">
              <button id="server-multi-btn" class="server-btn-secondary">
                <span class="btn-icon">üåê</span>
                Multijoueur
              </button>
            </div>
          </li>
          <li class="server-card">
            <div class="card-left">
              <div class="card-badge">PARTENAIRE</div>
              <div class="card-name">Serveurs Partenaires</div>
              <div class="card-meta">
                <span class="meta-pill"><span class="dot"></span> Aucun serveur disponible</span>
                <span class="meta-pill">Bientot</span>
              </div>
            </div>
            <div class="card-right">
              <button id="server-partner-btn" class="server-btn-disabled" aria-disabled="true">
                <span class="btn-icon">+</span>
                Ajouter un serveur
              </button>
            </div>
          </li>
        </ul>
        <div class="server-footer">
          <span class="hint">Aucun serveur partenaire n'est actif pour l'instant.</span>
        </div>
      </div>
    </div>
  </div>

  <div id="local-cinematic" class="hidden" aria-hidden="true">
    <iframe
      id="local-cinematic-frame"
      title="Cinematique locale"
      src="about:blank"
      allow="autoplay; fullscreen; picture-in-picture"
      allowfullscreen
    ></iframe>
    <button id="skip-cinematic-btn" type="button">Passer</button>
    <div id="cinematic-progress" aria-hidden="true">
      <div id="cinematic-progress-label">Chargement de la cinematique...</div>
      <div id="cinematic-progress-track">
        <div id="cinematic-progress-buffer"></div>
        <div id="cinematic-progress-fill"></div>
      </div>
    </div>
  </div>

  <main id="game-main">
    <button id="btn-open-menu" title="Retour au menu" aria-label="Retour au menu">‚ü≤</button>
    <canvas id="radar"></canvas>
    <div id="hud">
      <div id="notifications"></div>
      <div id="fuel-alerts" class="fuel-alert-panel hidden">
        <div class="alert-header">
          <span class="alert-icon">‚õΩ</span>
          <span class="alert-title">ALERTES CARBURANT</span>
          <button id="close-fuel-alerts" class="close-btn" title="Fermer les alertes">√ó</button>
        </div>
        <div id="fuel-alerts-list"></div>
      </div>
      <div id="info">Tapez un avion pour le s√©lectionner</div>

      <div id="mp-panel" class="mp-panel hidden">
        <div class="mp-header">
          <span class="mp-title">SERVEUR MULTIJOUEUR</span>
          <button id="mp-leave" class="btn-small">Quitter</button>
        </div>
        <div id="mp-status" class="mp-status">Hors ligne</div>
        <div id="mp-players" class="mp-players"></div>
        <div class="mp-vote-row">
          <div id="mp-vote-info" class="mp-vote-info">Aucun vote en cours</div>
          <button id="mp-vote" class="btn-small hidden">Voter</button>
        </div>
      </div>
      
      <!-- Interface r√©duite -->
      <div id="radio" class="control-panel compact">
        <div id="radio-status">Radio: <span id="radio-freq">121.500</span> MHz ¬∑ <span id="radio-link">NO LINK</span></div>
        <div class="btn-row compact">
          <button id="radio-dec" class="btn-small">-F</button>
          <button id="radio-sync" class="btn-small">Sync</button>
          <button id="radio-inc" class="btn-small">+F</button>
          <button id="zoom-out" class="btn-small">-Z</button>
          <button id="zoom-in" class="btn-small">+Z</button>
        </div>
        <div class="btn-row compact">
          <button id="toggle-notifications" class="notification-btn active btn-small" title="Activer/D√©sactiver les notifications">
            <span class="notif-icon">üîî</span>
          </button>
          <button id="clear-notifications" class="btn-small" title="Effacer toutes les notifications">
            üóëÔ∏è
          </button>
          <button id="toggle-fuel-alerts" class="fuel-alert-btn btn-small" title="Afficher/Masquer les alertes carburant">
            ‚õΩ <span id="fuel-count">0</span>
          </button>
        </div>
      </div>
      
      <div id="controls" class="hidden compact">
        <div id="selected"></div>
        <div class="btn-row compact">
          <button id="left" class="btn-small">‚óÄ</button>
          <button id="right" class="btn-small">‚ñ∂</button>
          <button id="slow" class="btn-small">-V</button>
          <button id="fast" class="btn-small">+V</button>
          <button id="desc" class="btn-small">-A</button>
          <button id="climb" class="btn-small">+A</button>
        </div>
        <div class="btn-row compact">
          <button id="dispatch" class="btn-small">Fighter</button>
          <button id="alert" class="btn-small">Alert</button>
          <button id="send-tanker" class="btn-small">Tanker</button>
          <button id="destroy" class="btn-small danger">Destroy</button>
        </div>
        <div class="btn-row compact">
          <button id="send-controller" class="btn-small">Controller</button>
          <button id="traj" class="btn-small">Traj</button>
          <button id="toggle-zones" class="btn-small">Zones</button>
          <button id="refuel" class="fuel-btn btn-small hidden" title="Ravitailler l'avion s√©lectionn√©">
            ‚õΩ Refuel
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <small>Optimis√© pour mobile ‚Äî ajoutez √† l'√©cran d'accueil sur iPhone</small>
  </footer>

  <script src="js/app.js"></script>
  <script type="module" src="js/multiplayer.js"></script>
  <script>
    (function purgeOldSW(){
      if(!('serviceWorker' in navigator)) return;
      try{
        navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister())).catch(() => {});
        if(window.caches && caches.keys){
          caches.keys().then(keys => keys.forEach(k => caches.delete(k))).catch(() => {});
        }
      }catch(e){}
      setTimeout(() => { navigator.serviceWorker.register('service-worker.js').catch(() => {}); }, 400);
    })();
  </script>
</body>
</html>
